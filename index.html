<!DOCTYPE html>

<html lang="pt-br">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>üèçüí® ALENCAR FRETES</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />

    <style>

        :root { 

            --accent: #ff9f43; 

            --bg: #000000; 

            --card: #1a1a1a; 

            --text: #ffffff; 

            --azul-marinho: #001f3f; 

            --verde-frete: #2ecc71; 

            --vermelho: #ff4444;

            --azul-neon: #00f3ff;

        }

        

        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;

        margin: 0; background: var(--bg); color: var(--text); overflow-x: hidden; }



        .header-top {

            display: flex;

            align-items: center; gap: 15px; padding: 10px 20px;

            background: var(--card); border-bottom: 2px solid var(--accent);

        }

        .logo-container img { height: 45px; width: 45px; border-radius: 50%; object-fit: cover;

        border: 1px solid var(--accent); }

        .header-title h1 { margin: 0; font-size: 1.2em;

        color: #ffffff; letter-spacing: 1px; }



        #map { height: 25vh; width: 100%;

        border-bottom: 2px solid var(--accent); }

        .leaflet-routing-container { display: none !important;

        }



        .container { 

            padding: 20px;

            display: flex; flex-direction: column; gap: 15px;

            max-width: 600px; margin: 0 auto;

        }

        

        input, select { 

            background: #222;

            border: 1px solid #444; color: white; padding: 12px; 

            border-radius: 8px; font-size: 16px; width: 100%; box-sizing: border-box; margin-top: 5px;

        }



        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px;

        }

        .input-group { display: flex; flex-direction: column; gap: 12px;

        }



        button { 

            padding: 15px;

            border-radius: 8px; border: none; font-weight: bold; 

            cursor: pointer; text-transform: uppercase; transition: all 0.1s; width: 100%;

        }



        .btn-calc { background: var(--verde-frete); color: white; box-shadow: 0 4px 0 #27ae60;

        }

        .btn-clear { background: #444; color: white; box-shadow: 0 4px 0 #222;

        }

        .btn-confirm { 

            background: #25d366;

            color: white; font-size: 16px; margin-top: 10px;

            box-shadow: 0 5px 0 #128c7e;

        }



        .tipo-residencia { display: flex; gap: 10px; margin-top: 5px;

        }

        .btn-tipo { background: #333; color: #888; border: 1px solid #444; box-shadow: none;

        }

        .btn-tipo.active { background: var(--azul-marinho); color: white; border: 1px solid var(--accent);

        }



        .resumo { 

            background: var(--card);

            padding: 15px; border-radius: 12px; border: 1px solid #333;

        }

        

        .valor-final { font-size: 1.8em;

        font-weight: 900; color: var(--verde-frete); }

        .distancia-texto { font-size: 0.9em; color: #aaa;

        }

        label { font-size: 0.75em; color: var(--accent); font-weight: bold; text-transform: uppercase;

        }



        /* AJUSTE SOLICITADO: Bairro e Tempo Estimado */

        .info-container {

            margin-top: 15px;

            display: flex;

            flex-direction: column;

            gap: 10px;

            text-align: center;

            border-top: 1px solid #333;

            padding-top: 10px;

        }

        .info-label {

            color: white;

            font-size: 0.8em;

            text-transform: uppercase;

            font-weight: bold;

        }

        .neon-3d {

            color: var(--azul-neon);

            font-weight: 900;

            text-transform: uppercase;

            text-shadow: 0 0 5px var(--azul-neon), 1px 1px 0px #000;

            display: block;

            font-size: 1.1em;

        }



        #dados-apto { display: none;

        }



        #avisoLucas { display: none; position: fixed; top: 0; left: 0; width: 100%;

        height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; flex-direction: column; justify-content: center; align-items: center;

        }

        .msg-box { background: #1a1a1a; padding: 30px; border-radius: 20px; border: 1px solid #444;

        text-align: center; width: 80%; }

        .loading { font-size: 14px; color: #f1c40f; display: none;

        margin-top: 15px; font-weight: bold;}

    </style>

</head>

<body>



<div class="header-top">

    <div class="logo-container">

        <img src="logo-cowboy-motofrete.png" alt="Logo">

    </div>

    <div class="header-title">

        <h1>ALENCAR FRETES</h1>

    </div>

</div>



<div id="avisoLucas">

    <div class="msg-box">

        <h2 style="color: var(--accent);">Confirmar Pedido?</h2>

        <p>Os dados ser√£o salvos no sistema e enviados para o WhatsApp do LUCAS.</p>

        

        <div id="loadingMsg" class="loading">

            üîÑ Salvando na planilha... aguarde...

        </div>



        <div id="btnArea">

            <button style="background:#25d366; color:white; width:100%; margin-top: 10px;"

            onclick="finalizarEnvio()">‚úÖ ENVIAR AGORA</button>

            <button style="background:transparent; color:#ff4444; border:1px solid #ff4444; margin-top:10px; width:100%;"

            onclick="fecharModal()">CANCELAR</button>

        </div>

    </div>

</div>



<div id="map"></div>



<div class="container">

    <div class="input-group">

        <div class="row">

            <div>

                <label>Data da Entrega *</label>

                <input type="date" id="data_entrega">

            </div>

            <div>

                <label>Hor√°rio *</label>

                <input type="time" id="hora_entrega">

            </div>

        </div>

        

        <div>

            <label>Nome do Cliente *</label>

            <input type="text" id="nome_cliente" placeholder="Nome completo">

        </div>



        <div>

            <label>Endere√ßo de Destino *</label>

            <input type="text" id="destino" placeholder="Rua, n¬∫, Bairro...">

        </div>



        <div>

            <label>Ponto de Refer√™ncia *</label>

            <input type="text" id="ponto_referencia" placeholder="Ex: Pr√≥ximo ao mercado...">

        </div>

        

        <div class="row">

            <button class="btn-clear" onclick="limpar()">Limpar</button>

            <button class="btn-calc" onclick="buscarRota()">CALCULAR FRETE</button>

        </div>



        <div>

            <label>Tipo de Local *</label>

            <div class="tipo-residencia">

                <button class="btn-tipo active" id="btn-casa" onclick="selecionarTipo('casa')">üè† CASA</button>

                <button class="btn-tipo" id="btn-apto" onclick="selecionarTipo('apto')">üè¢ APTO</button>

            </div>

        </div>



        <div class="row" id="dados-apto">

            <div>

                <label>Bloco *</label>

                <input type="text" id="bloco" placeholder="Ex: B">

            </div>

            <div>

                <label>Apto *</label>

                <input type="text" id="apto" placeholder="Ex: 12">

            </div>

        </div>

    </div>



    <div class="resumo">

        <div style="display: flex; justify-content: space-between; align-items: center;">

            <div class="distancia-texto">Dist√¢ncia: <span id="distancia" style="color: white; font-weight: bold;">0</span> km</div>

            <div class="valor-final" id="valor">R$ 0,00</div>

        </div>

        

        <div class="info-container" id="info-extra" style="display:none;">

            <div>

                <span class="info-label">Bairro</span>

                <span class="neon-3d" id="resumo_bairro">---</span>

            </div>

            <div>

                <span class="info-label">Tempo Estimado</span>

                <span class="neon-3d" id="resumo_tempo">---</span>

            </div>

        </div>

    </div>



    <button class="btn-confirm" onclick="prepararEnvio()">üì± Enviar dados P/ Lucas</button>

</div>



<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>



<script>

    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwvhHL4BiAecxAgumFmeFqmNhL62C87PSJ0zX1nIZTkB2tIDEz26y6SFbovQnh3B2oEHQ/exec"; 

    const TAXA_MINIMA = 5.00;

    const VALOR_POR_KM = 1.90;

    const ORIGEM_FIXA = L.latLng(-23.64464679519379, -46.72038817129933);

    const WHATSAPP_NUMERO = "5511981071822";



    let tipoResidencia = "casa"; 

    let rotaCalculada = false;



    const map = L.map('map', { zoomControl: false }).setView(ORIGEM_FIXA, 15);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    

    let control = L.Routing.control({

        waypoints: [ORIGEM_FIXA],

        lineOptions: { styles: [{ color: '#0025fa', weight: 6 }] },

        createMarker: (i, wp) => L.marker(wp.latLng),

        addWaypoints: false,

        show: false

    }).addTo(map);



    function selecionarTipo(tipo) {

        tipoResidencia = tipo;

        if (tipo === 'casa') {

            document.getElementById('btn-casa').classList.add('active');

            document.getElementById('btn-apto').classList.remove('active');

            document.getElementById('dados-apto').style.display = 'none';

        } else {

            document.getElementById('btn-apto').classList.add('active');

            document.getElementById('btn-casa').classList.remove('active');

            document.getElementById('dados-apto').style.display = 'grid';

        }

    }



    async function buscarRota() {

        const dest = document.getElementById('destino').value;

        if(!dest) return alert("Por favor, digite o endere√ßo de destino.");

        

        try {

            const resp = await fetch(`https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&q=${encodeURIComponent(dest + " S√£o Paulo")}`);

            const data = await resp.json();

            if(data.length > 0) {

                // Captura o bairro

                const bairro = data[0].address.suburb || data[0].address.neighbourhood || data[0].address.city_district || "N√£o Identificado";

                document.getElementById('resumo_bairro').innerText = bairro;

                

                control.setWaypoints([ORIGEM_FIXA, L.latLng(data[0].lat, data[0].lon)]);

            } else { alert("Endere√ßo n√£o localizado no mapa."); }

        } catch (e) { alert("Erro ao buscar rota."); }

    }



    control.on('routesfound', function(e) {

        const route = e.routes[0];

        const km = route.summary.totalDistance / 1000;

        const tempoSegundos = route.summary.totalTime;

        const tempoMinutos = Math.ceil(tempoSegundos / 60);

        

        let valorFinal = Math.max(TAXA_MINIMA, km * VALOR_POR_KM);

        

        document.getElementById('distancia').innerText = km.toFixed(2);

        document.getElementById('valor').innerText = valorFinal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

        document.getElementById('resumo_tempo').innerText = tempoMinutos + " MINUTOS";

        

        document.getElementById('info-extra').style.display = 'block';

        rotaCalculada = true;

        map.fitBounds(L.latLngBounds([ORIGEM_FIXA, route.inputWaypoints[1].latLng]), {padding: [30, 30]});

    });



    function limpar() {

        ['data_entrega','hora_entrega','destino','nome_cliente','bloco','apto','ponto_referencia'].forEach(id => document.getElementById(id).value = "");

        document.getElementById('distancia').innerText = "0";

        document.getElementById('valor').innerText = "R$ 0,00";

        document.getElementById('info-extra').style.display = 'none';

        selecionarTipo('casa');

        control.setWaypoints([ORIGEM_FIXA]);

        rotaCalculada = false;

    }



    function formatarDataCompleta(dataString) {

        if(!dataString) return "";

        const [ano, mes, dia] = dataString.split('-');

        const data = new Date(ano, mes - 1, dia);

        const opcoes = { weekday: 'long', year: 'numeric', month: '2-digit', day: '2-digit' };

        return data.toLocaleDateString('pt-BR', opcoes).toUpperCase();

    }



    function fecharModal() {

        document.getElementById('avisoLucas').style.display = 'none';

        document.getElementById('loadingMsg').style.display = 'none';

        document.getElementById('btnArea').style.display = 'block';

    }



    function prepararEnvio() {

        if (rotaCalculada === false) {

            return alert("‚ö†Ô∏è ERRO: Voc√™ precisa clicar em 'CALCULAR FRETE' antes de enviar o pedido!");

        }

        const data = document.getElementById('data_entrega').value;

        const hora = document.getElementById('hora_entrega').value;

        const nome = document.getElementById('nome_cliente').value;

        const dest = document.getElementById('destino').value;

        const ref = document.getElementById('ponto_referencia').value;



        if(!data || !hora || !nome || !dest || !ref) {

            return alert("Por favor, preencha TODOS os campos obrigat√≥rios*.");

        }

        if(tipoResidencia === 'apto') {

            const bloco = document.getElementById('bloco').value;

            const apto = document.getElementById('apto').value;

            if(!bloco || !apto) return alert("Para Apartamento, preencha Bloco e Apto.");

        }

        document.getElementById('avisoLucas').style.display = 'flex';

    }



    function finalizarEnvio() {

        const dataRaw = document.getElementById('data_entrega').value;

        const dataFormatada = formatarDataCompleta(dataRaw);

        const horaE = document.getElementById('hora_entrega').value;

        const nome = document.getElementById('nome_cliente').value;

        const dest = document.getElementById('destino').value;

        const ref = document.getElementById('ponto_referencia').value;

        const valor = document.getElementById('valor').innerText;

        const km = document.getElementById('distancia').innerText;

        const bairro = document.getElementById('resumo_bairro').innerText;

        const tempo = document.getElementById('resumo_tempo').innerText;

        

        let bloco = "---";

        let apto = "---";

        if(tipoResidencia === 'apto') {

            bloco = document.getElementById('bloco').value;

            apto = document.getElementById('apto').value;

        }



        let msg = `*NOVO PEDIDO - ALENCAR FRETES*%0A%0A`;

        msg += `üìÖ *DATA DA ENTREGA:* ${dataFormatada}%0A`;

        msg += `‚è∞ *HORA DA ENTREGA:* ${horaE}%0A`;

        msg += `üë§ *CLIENTE:* ${nome}%0A`;

        msg += `üè† *TIPO:* ${tipoResidencia.toUpperCase()}%0A`;

        if(tipoResidencia === 'apto') {

            msg += `üè¢ *BLOCO:* ${bloco} | üö™ *APTO:* ${apto}%0A`;

        }

        msg += `üìç *REF:* ${ref}%0A`;

        msg += `üèÅ *DESTINO:* ${dest}%0A`;

        msg += `üèòÔ∏è *BAIRRO:* ${bairro}%0A`;

        msg += `‚è±Ô∏è *TEMPO ESTIMADO:* ${tempo}%0A`;

        msg += `üìè *DIST√ÇNCIA:* ${km} km%0A`;

        msg += `üí∞ *VALOR:* ${valor}`;



        const dadosPlanilha = {

            data: dataFormatada,

            hora: horaE,

            nome: nome,

            destino: dest,

            referencia: ref,

            tipo: tipoResidencia,

            bloco: bloco,

            apto: apto,

            km: km,

            valor: valor

        };

        enviarParaGoogleSheets(dadosPlanilha, msg);

    }



    function enviarParaGoogleSheets(dados, msgWhatsapp) {

        if(GOOGLE_SCRIPT_URL.includes("SUA_URL")) {

            window.open(`https://wa.me/${WHATSAPP_NUMERO}?text=${msgWhatsapp}`, '_blank');

            fecharModal();

            return;

        }

        document.getElementById('loadingMsg').style.display = 'block';

        document.getElementById('btnArea').style.display = 'none';



        fetch(GOOGLE_SCRIPT_URL, {

            method: 'POST',

            mode: 'no-cors', 

            headers: { 'Content-Type': 'application/json' },

            body: JSON.stringify(dados)

        }).then(() => {

            setTimeout(() => {

                window.open(`https://wa.me/${WHATSAPP_NUMERO}?text=${msgWhatsapp}`, '_blank');

                fecharModal();

                limpar();

            }, 1000);

        }).catch(err => {

            alert("Erro ao salvar, abrindo WhatsApp...");

            window.open(`https://wa.me/${WHATSAPP_NUMERO}?text=${msgWhatsapp}`, '_blank');

            fecharModal();

        });

    }

</script>

</body>

</html>
